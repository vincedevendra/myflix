%article.video
  .container
    .row
      .video_large_cover.col-sm-7.col-sm-offset-1
        = image_tag @video.large_cover_url
      .video_info.col-sm-3
        %header
          %h3= @video.title
          - if @video.reviews.any?
            %span Rating: #{@video.average_rating}/5.0
        %p= @video.description
        .actions
          =link_to "Watch Now", @video.video_url, class: 'btn btn-primary'
          - unless current_user.has_video_in_queue?(@video)
            = link_to '+ My Queue', video_queue_items_path(@video), method: 'post', class: 'btn btn-default'
          - else
            %br/
            %br/
            = link_to 'X Remove From Queue', queue_item_path(current_user.video_queue_item(@video)), method: :delete, class: 'btn btn-default'

%section.reviews.container
  .row
    .col-sm-10.col-sm-offset-1
      = bootstrap_form_for [@video, @review] do |f|
        %fieldset
          .row
            = f.alert_message "Please fix the following problems:", error_summary: false
            = f.select :rating, ratings_choices, { label: "Rate this video" }, wrapper_class: 'col-sm-3'
          .row
            = f.text_area :body, label: "Write Review", rows: "6", wrapper_class: 'col-sm-8'
        %fieldset.form-group.actions.clearfix
          = f.submit "Submit"
          = link_to "Cancel", @video
      %header
        %h3 User Reviews (#{@video.reviews.count})
        - if @video.reviews.any?
          %ul
            - @video.reviews.each do |review|
              %article.review
                %li.row
                  .col-sm-2
                    %span Rating: #{review.rating} / 5
                    %p by #{link_to review.user.full_name, review.user}
                  .col-sm-8
                    %p= review.body
